<!DOCTYPE html>
<html>
<head>
    <title>Obesity Analysis</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>Obesity Analysis Dashboard</h1>
        <div class="chart-nav">
            <button class="chart-button active" data-chart="daily-activities">Daily Activities</button>
            <button class="chart-button" data-chart="meals">Meals per Day</button>
            <button class="chart-button" data-chart="water">Water Consumption</button>
            <button class="chart-button" data-chart="transport">Transportation Methods</button>
            <button class="chart-button" data-chart="family">Family History</button>
            <button class="chart-button" data-chart="calories">High-Calorie Food</button>
            <button class="chart-button" data-chart="gender">Gender Distribution</button>
        </div>
        <div id="vis"></div>
    </div>
    <script>
        // Chart specifications
        const specs = {
            "daily-activities": {
                "title": "Daily Activities Distribution by Gender and Obesity Type",
                "transform": [
                    {
                        "calculate": "datum.Gender == 'Female' ? -datum.count : datum.count",
                        "as": "signed_count"
                    },
                    {
                        "calculate": "abs(datum.signed_count)",
                        "as": "abs_count"
                    },
                    {
                        "calculate": "datum.Gender + '_' + datum.Ob_Type",
                        "as": "gender_obesity"
                    }
                ],
                "encoding": {
                    "y": {
                        "field": "DAILY_ACT",
                        "type": "nominal",
                        "title": "Daily Activities",
                        "axis": {
                            "title": "Daily Activities Level",
                            "labelAlign": "center"
                        }
                    },
                    "x": {
                        "field": "signed_count",
                        "type": "quantitative",
                        "title": "Number of People",
                        "axis": {
                            "format": "d",
                            "labelExpr": "abs(datum.value)"
                        }
                    },
                    "color": {
                        "field": "gender_obesity",
                        "type": "nominal",
                        "title": "Gender and Obesity Type",
                        "scale": {
                            "domain": [
                                "Male_Insufficient_Weight", "Male_Normal_Weight", "Male_Obesity_Type_I", 
                                "Male_Obesity_Type_II", "Male_Overweight_Level_I", "Male_Overweight_Level_II", 
                                "Male_Obesity_Type_III",
                                "Female_Insufficient_Weight", "Female_Normal_Weight", "Female_Obesity_Type_I", 
                                "Female_Obesity_Type_II", "Female_Overweight_Level_I", "Female_Overweight_Level_II", 
                                "Female_Obesity_Type_III"
                            ],
                            "range": [
                                "#e3f2fd", "#bbdefb", "#64b5f6", "#42a5f5", "#1565c0", "#0d47a1", "#2196f3",
                                "#ffcdd2", "#ef9a9a", "#ef5350", "#e53935", "#67000d", "#3e0008", "#d32f2f"
                            ]
                        },
                        "legend": {
                            "orient": "bottom",
                            "columns": 2,
                            "title": null
                        }
                    }
                },
                "isSpine": true
            },
            "meals": {
                "title": "Meals per Day Distribution by Gender and Obesity Type",
                "transform": [
                    {
                        "calculate": "datum.Gender == 'Female' ? -datum.count : datum.count",
                        "as": "signed_count"
                    },
                    {
                        "calculate": "abs(datum.signed_count)",
                        "as": "abs_count"
                    },
                    {
                        "calculate": "datum.Gender + '_' + datum.Ob_Type",
                        "as": "gender_obesity"
                    }
                ],
                "encoding": {
                    "y": {
                        "field": "MEALperDAY",
                        "type": "nominal",
                        "title": "Meals per Day",
                        "axis": {
                            "title": "Number of Meals",
                            "labelAlign": "center"
                        }
                    },
                    "x": {
                        "field": "signed_count",
                        "type": "quantitative",
                        "title": "Number of People",
                        "axis": {
                            "format": "d",
                            "labelExpr": "abs(datum.value)"
                        }
                    },
                    "color": {
                        "field": "gender_obesity",
                        "type": "nominal",
                        "title": "Gender and Obesity Type",
                        "scale": {
                            "domain": [
                                "Male_Insufficient_Weight", "Male_Normal_Weight", "Male_Obesity_Type_I", 
                                "Male_Obesity_Type_II", "Male_Overweight_Level_I", "Male_Overweight_Level_II", 
                                "Male_Obesity_Type_III",
                                "Female_Insufficient_Weight", "Female_Normal_Weight", "Female_Obesity_Type_I", 
                                "Female_Obesity_Type_II", "Female_Overweight_Level_I", "Female_Overweight_Level_II", 
                                "Female_Obesity_Type_III"
                            ],
                            "range": [
                                "#e3f2fd", "#bbdefb", "#64b5f6", "#42a5f5", "#1565c0", "#0d47a1", "#2196f3",
                                "#ffcdd2", "#ef9a9a", "#ef5350", "#e53935", "#67000d", "#3e0008", "#d32f2f"
                            ]
                        },
                        "legend": {
                            "orient": "bottom",
                            "columns": 2,
                            "title": null
                        }
                    }
                },
                "isSpine": true
            },
            "water": {
                "title": "Water Consumption Distribution by Gender and Obesity Type",
                "transform": [
                    {
                        "calculate": "datum.Gender == 'Female' ? -datum.count : datum.count",
                        "as": "signed_count"
                    },
                    {
                        "calculate": "abs(datum.signed_count)",
                        "as": "abs_count"
                    },
                    {
                        "calculate": "datum.Gender + '_' + datum.Ob_Type",
                        "as": "gender_obesity"
                    }
                ],
                "encoding": {
                    "y": {
                        "field": "WATER",
                        "type": "nominal",
                        "title": "Water Consumption",
                        "axis": {
                            "title": "Water Intake Level",
                            "labelAlign": "center"
                        }
                    },
                    "x": {
                        "field": "signed_count",
                        "type": "quantitative",
                        "title": "Number of People",
                        "axis": {
                            "format": "d",
                            "labelExpr": "abs(datum.value)"
                        }
                    },
                    "color": {
                        "field": "gender_obesity",
                        "type": "nominal",
                        "title": "Gender and Obesity Type",
                        "scale": {
                            "domain": [
                                "Male_Insufficient_Weight", "Male_Normal_Weight", "Male_Obesity_Type_I", 
                                "Male_Obesity_Type_II", "Male_Overweight_Level_I", "Male_Overweight_Level_II", 
                                "Male_Obesity_Type_III",
                                "Female_Insufficient_Weight", "Female_Normal_Weight", "Female_Obesity_Type_I", 
                                "Female_Obesity_Type_II", "Female_Overweight_Level_I", "Female_Overweight_Level_II", 
                                "Female_Obesity_Type_III"
                            ],
                            "range": [
                                "#e3f2fd", "#bbdefb", "#64b5f6", "#42a5f5", "#1565c0", "#0d47a1", "#2196f3",
                                "#ffcdd2", "#ef9a9a", "#ef5350", "#e53935", "#67000d", "#3e0008", "#d32f2f"
                            ]
                        },
                        "legend": {
                            "orient": "bottom",
                            "columns": 2,
                            "title": null
                        }
                    }
                },
                "isSpine": true
            },
            "transport": {
                "title": "Distribution of Transportation Methods by Obesity Type",
                "encoding": {
                    "color": {
                        "field": "TRANS",
                        "type": "nominal",
                        "title": "Transportation Method",
                        "scale": {
                            "scheme": "blues"
                        }
                    }
                }
            },
            "family": {
                "title": "Distribution of Family History of Overweight by Obesity Type",
                "encoding": {
                    "color": {
                        "field": "FAM_OVER",
                        "type": "nominal",
                        "title": "Family History of Overweight",
                        "scale": {
                            "scheme": "blues"
                        }
                    }
                }
            },
            "calories": {
                "title": "Distribution of High-Calorie Food Consumption by Obesity Type",
                "encoding": {
                    "color": {
                        "field": "HIGH_CAL",
                        "type": "nominal",
                        "title": "High-Calorie Food Consumption",
                        "scale": {
                            "scheme": "blues"
                        }
                    }
                }
            },
            "gender": {
                "title": "Distribution of Gender by Obesity Type",
                "encoding": {
                    "color": {
                        "field": "Gender",
                        "type": "nominal",
                        "title": "Gender",
                        "scale": {
                            "scheme": "set2"
                        }
                    }
                }
            }
        };

        // Load and parse CSV data
        async function loadData() {
            try {
                const response = await fetch('./Elhiz.csv');
                const csvText = await response.text();
                return new Promise((resolve) => {
                    Papa.parse(csvText, {
                        header: true,
                        dynamicTyping: true,
                        complete: function(results) {
                            // Filter out rows with undefined or null values
                            const cleanData = results.data.filter(row => 
                                row.DAILY_ACT != null && 
                                row.MEALperDAY != null && 
                                row.WATER != null && 
                                row.Gender && 
                                row.Ob_Type
                            );
                            resolve(cleanData);
                        }
                    });
                });
            } catch (error) {
                console.error('Error loading data:', error);
                return [];
            }
        }

        function createBaseSpec(specificSpec, data) {
            if (specificSpec.isSpine) {
                // Create spine chart specification
                return {
                    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
                    "data": { "values": data },
                    "title": specificSpec.title,
                    "transform": [
                        {
                            "filter": "datum[specificSpec.encoding.y.field] != null && datum.Gender != null && datum.Ob_Type != null"
                        },
                        {
                            "aggregate": [{
                                "op": "count",
                                "as": "count"
                            }],
                            "groupby": [specificSpec.encoding.y.field, "Gender", "Ob_Type"]
                        },
                        ...specificSpec.transform
                    ],
                    "mark": "bar",
                    "encoding": {
                        ...specificSpec.encoding,
                        "tooltip": [
                            {"field": specificSpec.encoding.y.field, "title": specificSpec.encoding.y.title},
                            {"field": "Gender"},
                            {"field": "Ob_Type", "title": "Obesity Type"},
                            {"field": "abs_count", "title": "Number of People"}
                        ]
                    },
                    "width": "container",
                    "height": 400,
                    "config": {
                        "view": { "stroke": null },
                        "axis": { "grid": false }
                    }
                };
            } else {
                // Regular chart specification
                return {
                    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
                    "data": { "values": data },
                    "title": specificSpec.title,
                    "mark": {
                        "type": "bar",
                        "cornerRadius": 4,
                        "tooltip": true
                    },
                    "encoding": {
                        "x": {
                            "field": "Ob_Type",
                            "type": "nominal",
                            "title": "Obesity Type",
                            "axis": {
                                "labelAngle": 0
                            }
                        },
                        "y": {
                            "aggregate": "count",
                            "title": "Number of People"
                        },
                        "color": specificSpec.encoding.color,
                        "opacity": {
                            "condition": {
                                "param": "hover",
                                "value": 1
                            },
                            "value": 0.8
                        },
                        "tooltip": [
                            {"field": "Ob_Type", "title": "Obesity Type"},
                            specificSpec.encoding.color,
                            {"aggregate": "count", "title": "Number of People"}
                        ]
                    },
                    "width": "container",
                    "height": 400,
                    "params": [{
                        "name": "hover",
                        "select": {
                            "type": "point",
                            "on": "mouseover",
                            "clear": "mouseout"
                        }
                    }],
                    "config": {
                        "view": { "stroke": null },
                        "axis": { "grid": false },
                        "legend": {
                            "orient": "bottom",
                            "titlePadding": 10,
                            "padding": 10
                        }
                    }
                };
            }
        }

        let currentChart = "daily-activities";
        const embedOpts = { actions: false, theme: "light" };
        let chartData = [];

        async function updateChart(chartType) {
            if (chartData.length === 0) {
                chartData = await loadData();
            }
            const spec = createBaseSpec(specs[chartType], chartData);
            vegaEmbed('#vis', spec, embedOpts);
        }

        // Add click handlers to buttons
        document.querySelectorAll('.chart-button').forEach(button => {
            button.addEventListener('click', (e) => {
                // Update active button
                document.querySelector('.chart-button.active').classList.remove('active');
                e.target.classList.add('active');
                
                // Update chart
                const chartType = e.target.dataset.chart;
                updateChart(chartType);
            });
        });

        // Initialize first chart
        updateChart(currentChart);
    </script>
</body>
</html> 